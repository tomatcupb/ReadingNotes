# 第十一章 后端编译与优化

## 11.1 概述
如果我们把字节码看做是程序语言表达的中间形式的话，
那么编译器无论在何时、何种状态下把Class文件转换成与本地基础设施(硬件指令集、操作系统)相关的二进制机器码，它都可以视为整个编译过程的后端。

## 11.2 即时编译器(Just In Time)
### 11.2.1 解释器与编译器
1. 解释器
    - 将编译好的字节码一行一行地翻译为机器码执行。
    - 优点
        - 当程序需要迅速启动的时候，解释器可以首先发挥作用，省去了编译的时间，立即执行。
        - 解释执行占用更小的内存空间。
        - 同时，当编译器进行的激进优化失败的时候，还可以进行逆优化来恢复到解释执行的状态("逃生门")。
1. 编译器
    - 以方法为单位，将字节码一次性翻译为机器码后执行。
    - 优点：在程序运行时，随着时间的推移，编译器逐渐发挥作用，把越来越多的代码编译成本地代码之后，可以获得更高的执行效率。  
  HotSpot虚拟机内置的编译器：
      - C1编译器, Client Compiler,客户端编译器
      - C2编译器, Server Compiler,服务端编译器
    - Graal编译器,JDK10出现，长期目标是替代C2编译器  
无论采用何种编译器，解释器与编译器搭配使用的方式在虚拟机中被称为“混合模式”(Mixed Mode)
    - -Xint,强制虚拟机运行于“解释模式”(Interpreted Mode)
    - -Xcomp，强制虚拟机运行于“编译模式”(Compiled Mode)
### 11.2.2 编译对象与触发条件
在运行过程中会被即时编译器编译的目标是“热点代码”，包括：
1. 被多次调用的方法
1. 被多次执行的循环体
要知道某段代码是不是“热点代码”，是不是需要出发即时编译，这个行为成为“热点探测”，
其实进行热点探测并不一定要知道方法具体被调用了多少次，目前的主流热点探测判定方法有两种，分别是：
1. 基于采样的热点探测(J9虚拟机)
1. 基于计数器的热点探测(HotSpot虚拟机)
    1. 方法调用计数器(Invocation Counter)
        1. 方法调用计数器热度的衰减(Counter Decay)
    1. 回边计数器(Back Edge Counter)
### 11.2.3 编译过程

## 11.3 提前编译器(Ahead OF Time)

## 11.4 编译器优化技术
### 11.4.1 优化技术概览
### 11.4.2 方法内联
### 11.4.3 逃逸分析
- 栈上分配
- 标量替换
- 同步消除
### 11.4.4 公共子表达式消除
### 11.4.5 数组边界检查消除

## 11.5 实战：深入理解Graal编译器
